---
name: signalfx-dotnet-tracing
icon_file: resources/signalfx.png
label: SignalFx Tracing Library for .NET for Pivotal Platform
description: |
  This tile contains CloudFoundry buildpacks that install the SignalFx Tracing Library for .NET
  on both windows and cflinuxfs3 machines. Both buildpacks are called "signalfx_dotnet_tracing_buildpack"
  and you can use them in .NET applications to automatically generate spans and send them to Splunk.
  For more documentation please see the buildpacks' README files.

packages:
- name: signalfx_dotnet_tracing_buildpack_linux
  label: SignalFx Tracing Library for .NET Buildpack (Linux)
  type: buildpack
  path: ./resources/signalfx_dotnet_tracing_buildpack-linux.zip
  buildpack_order: 98
  pre_deploy: |
    function install_buildpack() {
      local buildpackName="$1"
      local buildpackFile="$2"
      local buildpackOrder="$3"
      local stack="$4"
      cf buildpacks | grep -w "^${buildpackName}" | grep -w " ${stack}" >/dev/null
      if [ "$?" -eq "0" ]
      then
        cf update-buildpack "$buildpackName" -p "$buildpackFile" -s "$stack" --enable
      else
        cf create-buildpack "$buildpackName" "$buildpackFile" "$buildpackOrder" --enable
      fi
    }
  deploy: |
    BUILDPACK_NAME=signalfx_dotnet_tracing_buildpack
    BUILDPACK_ORDER=<%= Shellwords.escape properties.signalfx_dotnet_tracing_buildpack_linux.buildpack_order %>
    BUILDPACK_FILE=$PACKAGE_PATH/signalfx_dotnet_tracing_buildpack_linux/signalfx_dotnet_tracing_buildpack-linux.zip
    install_buildpack "$BUILDPACK_NAME" "$BUILDPACK_FILE" "$BUILDPACK_ORDER" cflinuxfs3
  delete: |
    cf delete-buildpack -f signalfx_dotnet_tracing_buildpack -s cflinuxfs3

- name: signalfx_dotnet_tracing_buildpack_windows
  label: SignalFx Tracing Library for .NET Buildpack (Windows)
  type: buildpack
  path: ./resources/signalfx_dotnet_tracing_buildpack-windows.zip
  buildpack_order: 99
  deploy: |
    BUILDPACK_NAME=signalfx_dotnet_tracing_buildpack
    BUILDPACK_ORDER=<%= Shellwords.escape properties.signalfx_dotnet_tracing_buildpack_windows.buildpack_order %>
    BUILDPACK_FILE=$PACKAGE_PATH/signalfx_dotnet_tracing_buildpack_windows/signalfx_dotnet_tracing_buildpack-windows.zip
    install_buildpack "$BUILDPACK_NAME" "$BUILDPACK_FILE" "$BUILDPACK_ORDER" windows
  delete: |
    cf delete-buildpack -f signalfx_dotnet_tracing_buildpack -s windows
